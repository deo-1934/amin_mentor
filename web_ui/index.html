<!-- #FEYZ -->
<!-- #DEO -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ù†ØªÙˆØ± Ø´Ø®ØµÛŒ Ø§Ù…ÛŒÙ†</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600&display=swap');

    :root {
      --accent: #17f7c9;
      --card-bg: rgba(20,20,20,0.85);
      --inner-bg: rgba(35,35,35,0.9);
      --text-main: #fff;
      --text-dim: #bbb;
      --radius-lg: 14px;
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      font-family: "Vazirmatn", system-ui, sans-serif;
    }

    /* ğŸŒŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø§ Ø¯Ùˆ Ø·ÛŒÙ Ùˆ ØªØºÛŒÛŒØ± Ù¾ÛŒÙˆØ³ØªÙ‡ hue */
    body {
      margin: 0;
      min-height: 100vh;
      background: #000;
      overflow: hidden;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .aurora {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 30% 40%, rgba(255,0,200,0.4), transparent 60%),
        radial-gradient(circle at 70% 60%, rgba(0,255,180,0.25), transparent 60%);
      filter: blur(80px) hue-rotate(0deg);
      animation: hueShift 60s linear infinite, moveAurora 25s ease-in-out infinite alternate;
      z-index: 0;
    }

    @keyframes hueShift {
      from { filter: blur(80px) hue-rotate(0deg); }
      to   { filter: blur(80px) hue-rotate(360deg); }
    }

    @keyframes moveAurora {
      0%   { background-position: 30% 40%, 70% 60%; }
      50%  { background-position: 20% 60%, 80% 40%; }
      100% { background-position: 40% 30%, 60% 70%; }
    }

    /* Ú©Ø§Ø±Øª Ú†Øª */
    .mentor-card {
      width: 600px;
      max-width: 94vw;
      background: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      box-shadow: 0 20px 80px rgba(0,0,0,0.8);
      backdrop-filter: blur(20px);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      z-index: 1;
    }

    .badge {
      background: rgba(23,247,201,0.08);
      border: 1px solid rgba(23,247,201,0.5);
      color: var(--accent);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      width: max-content;
      font-weight: 500;
    }

    .title {
      text-align: center;
      font-weight: 600;
      font-size: 1rem;
      line-height: 1.6;
    }

    .subtitle {
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-dim);
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .chat-box {
      background: var(--inner-bg);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.1);
      height: 320px;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .msg {
      padding: 0.7rem 1rem;
      border-radius: var(--radius-lg);
      font-size: 0.85rem;
      line-height: 1.6;
      white-space: pre-line;
      max-width: 90%;
      word-wrap: break-word;
    }

    .user-msg { background: rgba(255,255,255,0.08); align-self: flex-end; }
    .bot-msg  { background: rgba(60,60,60,0.9); align-self: flex-start; }

    .input-row {
      display: flex;
      gap: 0.6rem;
    }

    .ask-input {
      flex: 1;
      background: rgba(20,20,20,0.7);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius-lg);
      color: var(--text-main);
      padding: 0.8rem 1rem;
      font-size: 0.85rem;
      outline: none;
    }

    .send-btn {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: var(--radius-lg);
      padding: 0.8rem 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 60px rgba(23,247,201,0.4);
    }

    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
    .settings-fab {
      position: absolute;
      left: 1.2rem;
      bottom: 1.2rem;
      background: rgba(30,30,30,0.85);
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text-main);
      border-radius: 10px;
      font-size: 0.75rem;
      padding: 0.5rem 0.8rem;
      cursor: pointer;
      z-index: 2;
    }

    .settings-panel {
      position: absolute;
      left: 1.2rem;
      bottom: 4rem;
      background: rgba(15,15,15,0.9);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 1rem;
      width: 230px;
      display: none;
      flex-direction: column;
      gap: 0.6rem;
      z-index: 2;
    }

    .length-option {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--text-dim);
      border-radius: 8px;
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: 0.12s;
    }

    .length-option.active {
      background: rgba(23,247,201,0.08);
      color: var(--accent);
      border-color: rgba(23,247,201,0.5);
    }

    .regen-btn {
      background: rgba(255,255,255,0.08);
      color: var(--text-main);
      border: none;
      border-radius: 8px;
      padding: 0.5rem;
      font-size: 0.75rem;
      cursor: pointer;
    }

  </style>
</head>

<!-- #FEYZ -->
<!-- #DEO -->

<body>
  <div class="aurora"></div>

  <main class="mentor-card">
    <span class="badge">Ù…Ù†ØªÙˆØ± Ø´Ø®ØµÛŒ Ø§Ù…ÛŒÙ†</span>
    <div class="title">ÛŒÚ© Ù…Ø±Ø¨ÛŒ Ú©Ù†Ø§Ø±ØªÙ‡Ø› Ø¯Ù‚ÛŒÙ‚ØŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ùˆ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³.</div>
    <div class="subtitle">Ø¨Ù¾Ø±Ø³ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØŒ ÙØ±ÙˆØ´ ÛŒØ§ Ù…Ø°Ø§Ú©Ø±Ù‡Ø› Ù…Ù† ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ù¾Ø§Ø³Ø® ÙˆØ§Ø¶Ø­ Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ø¨Ø¯Ù….</div>

    <div id="chatBox" class="chat-box">
      <div class="msg bot-msg">Ø³Ù„Ø§Ù…! Ù…Ù† Ù…Ù†ØªÙˆØ± Ø§Ù…ÛŒÙ† Ù‡Ø³ØªÙ…. Ú†Ø§Ù„Ø´ Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Øª Ø§Ù„Ø§Ù† Ú†ÛŒÙ‡ØŸ</div>
    </div>

    <div class="input-row">
      <input id="userInput" class="ask-input" placeholder="Ø³Ø¤Ø§Ù„Ù… Ø§ÛŒÙ†Ù‡..." />
      <button id="sendBtn" class="send-btn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>
  </main>

  <button id="openSettingsBtn" class="settings-fab">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
  <aside id="settingsPanel" class="settings-panel">
    <div>Ø·ÙˆÙ„ Ù¾Ø§Ø³Ø®:</div>
    <div id="lengthOptions">
      <div class="length-option active" data-value="short">Ú©ÙˆØªØ§Ù‡</div>
      <div class="length-option" data-value="normal">Ù…Ø¹Ù…ÙˆÙ„ÛŒ</div>
      <div class="length-option" data-value="long">Ø·ÙˆÙ„Ø§Ù†ÛŒ</div>
    </div>
    <button id="regenBtn" class="regen-btn">Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø® â†»</button>
  </aside>

  <script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const lengthOptions = document.getElementById("lengthOptions");
    const regenBtn = document.getElementById("regenBtn");
    const openSettingsBtn = document.getElementById("openSettingsBtn");
    const settingsPanel = document.getElementById("settingsPanel");

    let selectedLength = "short";
    let lastUserMessage = "";

    openSettingsBtn.onclick = () => {
      settingsPanel.style.display = settingsPanel.style.display === "flex" ? "none" : "flex";
      settingsPanel.style.flexDirection = "column";
    };

    lengthOptions.onclick = (e) => {
      const opt = e.target.closest(".length-option");
      if (!opt) return;
      [...lengthOptions.children].forEach(o => o.classList.remove("active"));
      opt.classList.add("active");
      selectedLength = opt.dataset.value;
    };

    regenBtn.onclick = () => {
      if (!lastUserMessage) return;
      sendMessage(lastUserMessage, true);
    };

    async function sendMessage(msg = null, regen = false) {
      const text = msg || userInput.value.trim();
      if (!text) return;
      lastUserMessage = text;

      appendMessage("user", text);
      userInput.value = "";

      appendMessage("bot", regen ? "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø®..." : "Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...");

      try {
        const res = await fetch("http://127.0.0.1:8000/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text, length: selectedLength })
        });
        const data = await res.json();
        updateLastBotMessage(data.answer || "Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø² Ù…Ø¯Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.");
      } catch (err) {
        updateLastBotMessage("Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯. Ù…Ø·Ù…Ø¦Ù†ÛŒ ÙØ¹Ø§Ù„Ø´ Ú©Ø±Ø¯ÛŒØŸ");
      }
    }

    function appendMessage(role, text) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("msg", role === "user" ? "user-msg" : "bot-msg");
      msgDiv.textContent = text;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function updateLastBotMessage(newText) {
      const msgs = chatBox.querySelectorAll(".bot-msg");
      const last = msgs[msgs.length - 1];
      if (last) last.textContent = newText;
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    sendBtn.onclick = () => sendMessage();
    userInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
  </script>
</body>
</html>
